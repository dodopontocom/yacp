<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="noindex,nofollow" />

    <title></title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        function setThemeClass() {
            document.documentElement.className = Telegram.WebApp.colorScheme;
        }
        Telegram.WebApp.onEvent('themeChanged', setThemeClass);
        setThemeClass();

    </script>
    <link rel="stylesheet" type="text/css" media="all" href="https://dodopontocom.github.io/yacp/telegram/style.css">
</head>

<body>
<section>
    <canvas id="myCanvas" width="35%"></canvas>
    <script>
    function animate() {
            if (stars.length<300&&Math.random()<.5){ // if fewer than 300 stars, a 50% chance of creating a new one
                    let star={x:0,y:0,vx:-5+Math.random()*10,vy:-5+Math.random()*10} // create a new star in the middle with random velocity
                    stars.push(star); // add the star to the array
                    }
            context.clearRect(0, 0, canvas.width, canvas.height); // clear the frame
            for(let n=0;n<stars.length;n++){ // for each star
                    stars[n].x=stars[n].x+stars[n].vx; // add the velocity to the current position
                    stars[n].y=stars[n].y+stars[n].vy; // in both axles
                    if(stars[n].x>400||stars[n].x<-400){ // if the star is out of bounds
                            stars[n].x=0;  // put it back in the center
                            stars[n].y=0;
                    }
            color=Math.floor((Math.abs(stars[n].x)+Math.abs(stars[n].y))/5);
            context.fillStyle = 'rgb('+color+','+color+','+color+')'; // use the color value for the R, G and B component
            context.beginPath();
            context.arc(400+stars[n].x, 400+stars[n].y, Math.abs(stars[n].y/100+n/200), 0, 2 * Math.PI); // draw a circle
            context.fill();
            }
            window.requestAnimationFrame(animate); // request another animation frame
    }
    
    let canvas = document.getElementById('myCanvas');
    let context = canvas.getContext('2d');
    let stars=[]; // the array of stars
    window.requestAnimationFrame(animate); // initialize the animation
    </script>

    <!-- <img src="https://dodopontocom.github.io/yacp/telegram/logo.gif" width="35%"> -->

    <h1 id="greeting"></h1>

    <h3>Init Data: </h3>
    <pre id="initData"></pre>
    <h3>Init Data (unsafe): </h3>
    <pre id="initDataUnsafe"></pre>

    <div id="buttons">
        <button id="btnSendTime" onclick="sendTime();">TEST</button>
        <small>(The bot will recieve a message with filled <code>web_app_data</code> field)</small>
        <button id="btnNativePopup" onclick="showPopNative();">POPUP</button>
        <small>(Native Popup)</small>
    </div>

</section>

<script type="application/javascript">
    Telegram.WebApp.ready();

    const initData = Telegram.WebApp.initData || '';
    const initDataUnsafe = Telegram.WebApp.initDataUnsafe || {};

    document.querySelector('#greeting').innerHTML = `ðŸ—£ Hello, ${initDataUnsafe.user.first_name}!`;
    document.querySelector('#initData').innerHTML = JSON.stringify(initData, null, 2);
    document.querySelector('#initDataUnsafe').innerHTML = JSON.stringify(initDataUnsafe, null, 2);
    document.querySelector('#themeData').html(JSON.stringify(Telegram.WebApp.themeParams, null, 2));

    Telegram.WebApp.MainButton
        .setText('BYE')
        .show()
        .onClick(function(){ webviewClose(); });

    Telegram.WebApp.onEvent('themeChanged', function() {
        document.querySelector('#themeData').innerHTML = JSON.stringify(Telegram.WebApp.themeParams, null, 2);
    });

    function sendTime() {
        Telegram.WebApp.sendData(new Date().toString());
        console.log(new Date().toString())
    }
    
    function showPopNative() {
        Telegram.WebApp.showPopup('Title', 'Message here');
        console.log('pop')
    }

</script>

</body>
</html>